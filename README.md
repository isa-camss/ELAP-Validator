# ELAP validator configuration

This repository includes the configuration for the ELAP validator. It includes both:
* The development tools needed to edit and build the configuration.
* The final configuration used within the live validator.

The ELAP validator is an instance of the Interoperability Test Bed's [XML validator](https://www.itb.ec.europa.eu/docs/guides/latest/validatingXML/).

## Validation rule development

All development tools for the validator's configuration are located under `src`.

The development and processing of validation rules, specifically Schematron rules, is driven by Apache Maven (version 3+).
The repository's POM file (`pom.xml`) defines plugins to carry out the necessary steps. Overall, to make full build and
update of the applicable rules issue:

```
mvn clean package
```

Doing so will carry out the following tasks in sequence:
1. The ELAP SAT (`src/main/resources/sat/ELAP_sat.xml`) will be processed to generate the set of rules that require 
pre-processing (e.g. rules needing to check for all principles). The processing is an XSLT transformation using 
`src/main/resources/generation/sat_to_sch_transformation.xslt` that results in a Schematron file generated in the `target`
folder. Note that the SAT must be defined in the ArchiMate Model Exchange Format.
2. The Schematron files defined in `src/main/resources/sch` as well as the ones generated by the previous step and then
compiled to generate the corresponding XSLT files to be used in the validator. These are similarly generated in the `target`
folder.
3. The final XSLT files, as well as any other files needed (the ELAP SAT from `src/main/resources/sat/ELAP_sat.xml`) are 
copied to their expected location in the validator's configuration under `validator/latest`.

When developing you typically need to edit the Schematron files under `src/main/resources/sch`. These are as follows:

```
src/main/resources/sch
├── sat_master.sch          # The entry point for the validation of SATs.
├── solution_master.sch     # The entry point for the validation of solutions.
└── partials                # Schematron fragments included in the master files.
    ├── parent.sch          # Definitions of all common elements and functions.
    ├── common_rules.sch    # Rules that apply to all types of models.
    ├── sat_rules.sch       # Rules that apply only to SAT models.
    └── solution_rules.sch  # Rules that apply only to solution models.  
```

When developing rules or testing different inputs it can be useful to validate directly from the current project without
going through the validator. This is achieved via a Maven plugin tied to the Maven `verify` phase, the configuration of
which in `pom.xml` you can adapt to point to different Schematrons and/or inputs. Validation can then be carried out via:

```
mvn verify
```

## Validation configuration

The validator's configuration is located under `validator`. This is the folder considered to define and launch the validator
instance. The contents of this folder are as follows:

```
validator
├── config.properties       # The validator's configuration file.
├── common                  # Common resources (e.g. the XSDs for ArchiMate syntax validation.
└── latest
    └── sch
        ├── ELAP_sat.xml    # The ELAP SAT (in MEF syntax).
        └── sch             # The Schematron XSLTs
```

Note that any change to any resource in the current repository's master branch will trigger an update to the live validator.

## Using the validator

The live ELAP validator is available as follows:
* Via UI at: https://www.itb.ec.europa.eu/elap/upload
* Via SOAP API at: https://www.itb.ec.europa.eu/elap/api/validation?wsdl
* Via REST API at: https://www.itb.ec.europa.eu/elap/swagger-ui/index.html